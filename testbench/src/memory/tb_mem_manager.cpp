#include "Vmem_manager.h" // Generated by Verilator
#include "verilated.h"

#include "testbench.h"

// Main
int main(int argc, char **argv)
{
    Verilated::commandArgs(argc, argv);
    Testbench<Vmem_manager> tb("Mem_manager");

    // assign some inputs
    tb.dut->data_in_a = 0xFFFFFFFF;
    tb.dut->data_in_b = 0xFFFFFFFF;
    tb.dut->byteen_in_a = 0xF;
    tb.dut->addr_in_a = 0;
    tb.dut->addr_in_b = 0;

    tb.dut->aclr_in_a = 1;
    tb.dut->rden_in_a = 1;
    tb.dut->rden_in_b = 1;
    tb.dut->wren_in_a = 1;

    tb.dut->enable_in_a = 1;
    tb.dut->eval();

    // tests that the output are 0 (no address match)
    tb.check_equality((unsigned int)tb.dut->data_out_a, (unsigned int)0, "data_out_a");
    tb.check_equality((unsigned int)tb.dut->data_out_b, (unsigned int)0, "data_out_b");
    tb.check_equality((unsigned int)tb.dut->byteen_out_a, (unsigned int)0, "byteen_out_a");
    tb.check_equality((unsigned int)tb.dut->addr_out_a, (unsigned int)0, "addr_out_a");
    tb.check_equality((unsigned int)tb.dut->addr_out_b, (unsigned int)0, "addr_out_b");
    tb.check_equality((unsigned int)tb.dut->aclr_out_a, (unsigned int)1, "aclr_out_a");
    tb.check_equality((unsigned int)tb.dut->enable_out_a, (unsigned int)0, "enable_out_a");
    tb.check_equality((unsigned int)tb.dut->rden_out_a, (unsigned int)0, "rden_out_a");
    tb.check_equality((unsigned int)tb.dut->rden_out_b, (unsigned int)0, "rden_out_b");
    tb.check_equality((unsigned int)tb.dut->wren_out_a, (unsigned int)0, "wren_out_a");

    // match the port A inputs
    tb.dut->addr_in_a = 0xFFFFAAAA;
    tb.dut->addr_in_b = 0;
    tb.dut->eval();

    tb.check_equality((unsigned int)tb.dut->data_out_a, (unsigned int)0xFFFFFFFF, "data_out_a");
    tb.check_equality((unsigned int)tb.dut->data_out_b, (unsigned int)0, "data_out_b");
    tb.check_equality((unsigned int)tb.dut->byteen_out_a, (unsigned int)0xF, "byteen_out_a");
    tb.check_equality((unsigned int)tb.dut->addr_out_a, (unsigned int)0xAAAA, "addr_out_a");
    tb.check_equality((unsigned int)tb.dut->addr_out_b, (unsigned int)0, "addr_out_b");
    tb.check_equality((unsigned int)tb.dut->aclr_out_a, (unsigned int)1, "aclr_out_a");
    tb.check_equality((unsigned int)tb.dut->enable_out_a, (unsigned int)1, "enable_out_a");
    tb.check_equality((unsigned int)tb.dut->rden_out_a, (unsigned int)1, "rden_out_a");
    tb.check_equality((unsigned int)tb.dut->rden_out_b, (unsigned int)0, "rden_out_b");
    tb.check_equality((unsigned int)tb.dut->wren_out_a, (unsigned int)1, "wren_out_a");

    // match the port B inputs
    tb.dut->addr_in_a = 0;
    tb.dut->addr_in_b = 0xFFFFAAAA;
    tb.dut->eval();

    tb.check_equality((unsigned int)tb.dut->data_out_a, (unsigned int)0, "data_out_a");
    tb.check_equality((unsigned int)tb.dut->data_out_b, (unsigned int)0xFFFFFFFF, "data_out_b");
    tb.check_equality((unsigned int)tb.dut->byteen_out_a, (unsigned int)0, "byteen_out_a");
    tb.check_equality((unsigned int)tb.dut->addr_out_a, (unsigned int)0, "addr_out_a");
    tb.check_equality((unsigned int)tb.dut->addr_out_b, (unsigned int)0xAAAA, "addr_out_b");
    tb.check_equality((unsigned int)tb.dut->aclr_out_a, (unsigned int)1, "aclr_out_a");
    tb.check_equality((unsigned int)tb.dut->enable_out_a, (unsigned int)0, "enable_out_a");
    tb.check_equality((unsigned int)tb.dut->rden_out_a, (unsigned int)0, "rden_out_a");
    tb.check_equality((unsigned int)tb.dut->rden_out_b, (unsigned int)1, "rden_out_b");
    tb.check_equality((unsigned int)tb.dut->wren_out_a, (unsigned int)0, "wren_out_a");

    return tb.get_return();
}
